---
import { getCollection } from "astro:content";
import Layout from "@layout/Layout.astro";
import PostList from "@components/PostList.astro";
import { getPostsByTag } from "@utils/posts";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  const tags = posts.flatMap((post) => post.data.tags ?? []);
  const uniqueTags = [...new Set(tags)];
  return uniqueTags.map((tag) => ({
    params: { id: tag },
  }));
}

const { id } = Astro.params;
const posts = await getPostsByTag(id);

---

<Layout title={`#${id}`} description={`带有标签 #${id} 的文章列表`}>
  <PostList posts={posts} tag={id} />
</Layout>